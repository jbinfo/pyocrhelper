#labels Phase-Design
*This page describes how pyocrhelper analyses html page layout output by ocropus.*
----

*What does a line of content from Ocropus look like?*

When Ocropus analyses an image, it scans on a line per line basis. Thus, the html output by Ocropus is very line intensive in nature. A typical Ocropus content line looks something like:

{{{
   <span class='ocr_line' title='bbox 237 371 2058 412'>I am a line of Ocropus content</span>
}}}

From the above, the text {{{'I am a line of Ocropus content'}}} is exactly the text which was present in the image - i.e. what the reader will eventually read.

From looking at the <span> tag, it is possible to see that Ocropus usefully output some positional information for us. This positional information does not seem to be used in the html markup (Ocropus could possibly use css formatting which might make use of the bbox but I'm not sure about this). As far as I can tell, using the above example:

  * 237 is the leftmost x coordinate
  * 371 is the topmost y coordinate
  * 2058 is the rightmost x coordinate
  * 412 is the bottommost y coordinate

{{{
237,371
       +--------------------------------+
       | I am a line of Ocropus content |
       +--------------------------------+ 2058,412
}}}


*Analysing the layout of a typical Ocropus html page*

----

If we split the html string output from pyocrhelper (or Ocropus for that matter) into lines, we can examine each line individually and feed the data into an array/list (which we can later analyse more completely). Thus (from pyocrhelper.py):

{{{
    def _getCoordinates(self,string):
        """
        Use a regular expression to extract the page coordinates
        from a typical hOcr string
        """
        # split this into multiple lines
        getdigits = re.compile(r'bbox\s+?(?P<pos1>\d{1,4})\s+?\
                    (?P<pos2>\d{1,4})\s+?(?P<pos3>\d{1,4})\s+?\
                    (?P<pos4>\d{1,4})',re.S)
        a = re.search(getdigits,string)
        if not a:
            return None
        else:
            return (int(a.group('pos1')),int(a.group('pos2')),\
                    int(a.group('pos3')),int(a.group('pos4')))

hold_left_col = []
content_line_match = re.compile(r'<span.*</span>',re.S)
ocr_lines = ocropus_output.split('\n')
for line in ocr_lines:
    if re.match(content_line_match,line):
        coordinates = self._getCoordinates(line)
        hold_left_col.append(coordinates[0]) # append leftmost x coord

print hold_left_col
[796, 93, 203, 1811, 478, 476, 478, 478, 477, 477, 477, 477, 
477, 476, 476, 475, 516, 514, 513, 513, 514, 513, 513, 473, 
475, 475, 474, 476, 472, 474, 474, 475, 474, 474, 474, 472, 
471, 473, 473, 474, 473, 181, 1469, 1468, 1466, 1468, 1468, 
1467, 1468, 1465, 1467, 1467, 1467, 1465, 1466, 1466, 1467, 
1467, 1467, 1467, 1466, 1466, 1466, 1466, 1532, 1502, 1534, 
1502, 1502, 1499, 1501, 1501, 1534, 1500, 1501, 1501, 1501, 
1500, 1500, 1523]

}}}

For the document above (a two column page of text), Ocropus recognised two 'main' column left boundaries - if we cancel out the 'noise', these are roughly the x coordinates ~477 and ~1470.